<!DOCTYPE html>
<html>
<head>
<title>Blog SaaS</title>
<style>
body{font-family:Arial;background:#eef2f7}
.box{width:420px;margin:40px auto;background:white;padding:20px;border-radius:10px}
img{width:100%;border-radius:8px}
input,textarea,button{width:100%;margin-top:6px;padding:8px}
button{background:#4f46e5;color:white;border:none}
.logout{background:#dc2626}
.post{border:1px solid #ddd;padding:10px;margin-top:10px}
.hidden{display:none}
.small{font-size:12px;color:#555}
</style>
</head>

<body>

<div class="box" id="loginBox">
<img src="https://images.unsplash.com/photo-1498050108023-c5249f4df085">
<h2>Login</h2>
<input id="email" placeholder="Email (admin@test.com)">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="box hidden" id="dashboard">
<h3 id="roleText"></h3>

<div id="adminBox">
<input id="title" placeholder="Title">
<textarea id="content" placeholder="Content"></textarea>
<input type="file" id="image">
<button onclick="createPost()">Create Post</button>
</div>

<button class="logout" onclick="logout()">Logout</button>
<div id="posts"></div>
</div>

<script>
let token="", role="", editId=null;

function login(){
fetch("http://localhost:5000/api/login",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({email:email.value,password:password.value})
})
.then(r=>r.json())
.then(d=>{
token=d.token; role=d.role;
loginBox.classList.add("hidden");
dashboard.classList.remove("hidden");
roleText.innerText="Role: "+role;
if(role!=="admin") adminBox.style.display="none";
loadPosts();
});
}

function logout(){
token=""; location.reload();
}

function createPost(){
const f=image.files[0];
const r=new FileReader();
r.onload=()=>{
fetch("http://localhost:5000/api/posts",{
method:"POST",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+token
},
body:JSON.stringify({title:title.value,content:content.value,image:r.result})
}).then(loadPosts);
};
if(f) r.readAsDataURL(f);
}

function loadPosts(){
fetch("http://localhost:5000/api/posts",{
headers:{Authorization:"Bearer "+token}
})
.then(r=>r.json())
.then(d=>{
posts.innerHTML="";
d.forEach(p=>{
posts.innerHTML+=`
<div class="post">
<img src="${p.image}">
<h4>${p.title}</h4>
<p>${p.content}</p>
${role==="admin"?`
<button onclick="editPost(${p.id},'${p.title}','${p.content}')">Edit</button>
<button onclick="deletePost(${p.id})">Delete</button>`:""}
</div>`;
});
});
}

function editPost(id,t,c){
editId=id;
title.value=t;
content.value=c;
createPost=updatePost;
}

function updatePost(){
fetch("http://localhost:5000/api/posts/"+editId,{
method:"PUT",
headers:{
"Content-Type":"application/json",
"Authorization":"Bearer "+token
},
body:JSON.stringify({title:title.value,content:content.value})
}).then(()=>location.reload());
}

function deletePost(id){
fetch("http://localhost:5000/api/posts/"+id,{
method:"DELETE",
headers:{Authorization:"Bearer "+token}
}).then(loadPosts);
}
</script>

</body>
</html>

